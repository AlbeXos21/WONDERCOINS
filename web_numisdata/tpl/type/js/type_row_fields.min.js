"use strict";import{COLOR_PALETTE,chart_wrapper}from"../../lib/charts/chart-wrapper";import{minimal_boxvio_chart_wrapper}from"../../lib/charts/d3/boxvio/minimal-boxvio-chart-wrapper";import{minimal_clock_chart_wrapper}from"../../lib/charts/d3/clock/minimal-clock-chart-wrapper";export const type_row_fields={caller:null,type:"",equivalents:"",weight_chat_wrapper:null,diameter_chart_wrapper:null,axis_chart_wrapper:null,draw_item:function(item){const self=this,fragment=new DocumentFragment;if(!0===dedalo_logged){const dedalo_link_link=self.dedalo_link(item,"numisdata3");fragment.appendChild(dedalo_link_link)}const golden_separator=document.querySelector(".golden-separator"),cite=common.create_dom_element({element_type:"span",class_name:"cite_this_record",text_content:tstring.cite_this_record||"cite this record",parent:golden_separator});cite.addEventListener("click",(async function(){const main_catalog_data=await page.load_main_catalog(),cite_data=main_catalog_data.result[0],publication_data=cite_data.publication_data[0];cite_data.autors={authorship_data:item.authorship_data||null,authorship_names:item.authorship_names||null,authorship_surnames:item.authorship_surnames||null,authorship_roles:item.authorship_roles||null},cite_data.catalog=null,cite_data.title="<em>"+self.type+"</em>",cite_data.publication_data=publication_data,cite_data.uri_location=window.location;const cite_data_node=biblio_row_fields.render_cite_this(cite_data),popUpContainer=common.create_dom_element({element_type:"div",class_name:"float-cite",parent:document.body});popUpContainer.addEventListener("mouseup",(function(){popUpContainer.classList.add("copy"),cite_data_node.classList.add("copy");const selection=window.getSelection(),copy_range=document.createRange();copy_range.selectNodeContents(cite_data_node),selection.removeAllRanges(),selection.addRange(copy_range),document.execCommand("copy"),window.getSelection().removeAllRanges()}));const title=common.create_dom_element({element_type:"div",class_name:"float-label",text_content:tstring.cite_this_record||"Cite this record",parent:popUpContainer}),close_buttom=common.create_dom_element({element_type:"div",class_name:"close-buttom",parent:popUpContainer});close_buttom.addEventListener("click",(function(){})),document.body.addEventListener("click",(function(event_cite){document.body.removeEventListener("click",(function(event_cite){})),popUpContainer.remove()})),popUpContainer.appendChild(cite_data_node);const click_to_copy=common.create_dom_element({element_type:"div",class_name:"float-text_copy",text_content:tstring.click_to_copy||"Click to copy",parent:popUpContainer})})),fragment.appendChild(self.catalog_hierarchy(item,"catalog_hierarchy")),fragment.appendChild(self.creators(item,"creators"));const identify_coin=common.create_dom_element({element_type:"div",class_name:"identify_coin_wrapper gallery",parent:fragment});identify_coin.appendChild(self.image(item,"ref_coins_image_obverse")),identify_coin.appendChild(self.image(item,"ref_coins_image_reverse")),common.create_dom_element({element_type:"div",id:"embedded-gallery",parent:fragment}),fragment.appendChild(self.id_line(item,"id_line"));const sides_wrapper=common.create_dom_element({element_type:"div",class_name:"sides_wrapper",parent:fragment}),obverse_wrapper=common.create_dom_element({element_type:"div",class_name:"obverse_wrapper",parent:sides_wrapper});obverse_wrapper.appendChild(self.default(item,"design_obverse")),obverse_wrapper.appendChild(self.default(item,"symbol_obverse")),item.legend_obverse&&obverse_wrapper.appendChild(page.render_legend({value:item.legend_obverse,style:"median legend_obverse_box"})),obverse_wrapper.appendChild(self.default(item,"legend_obverse_transcription"));const reverse_wrapper=common.create_dom_element({element_type:"div",class_name:"reverse_wrapper",parent:sides_wrapper});if(reverse_wrapper.appendChild(self.default(item,"design_reverse")),reverse_wrapper.appendChild(self.default(item,"symbol_reverse")),item.legend_reverse&&reverse_wrapper.appendChild(page.render_legend({value:item.legend_reverse,style:"median legend_reverse_box"})),reverse_wrapper.appendChild(self.default(item,"legend_reverse_transcription")),fragment.appendChild(self.default(item,"public_info",page.local_to_remote_path)),fragment.appendChild(self.default(item,"equivalents",(function(value){const beats=page.split_data(value,"<br>"),ar_final=[];for(let i=0;i<beats.length;i++)ar_final.push(beats[i].replace(/ \| /g," "));return self.equivalents=ar_final.join(" | "),self.equivalents}))),item.related_types){const related_types=item.related_types,related_types_data=item.related_types_data,label=tstring.related_types||"Related types",beats=related_types_data.length,ar_final=[];for(let i=0;i<beats;i++){const related_type=related_types_data[i],related_mint=related_type.mint?related_type.mint:"...",related_mint_number=related_type.mint_number?related_type.mint_number:"..",related_type_number=related_type.number?related_type.number:"..",related_label=related_mint+" "+related_mint_number+"/"+related_type_number,related_id=!!related_type.section_id&&related_type.section_id,url=page_globals.__WEB_ROOT_WEB__+"/type/"+related_id,current_related_typo=related_id?'<a href="'+url+'">'+related_label+"</a>":related_label;ar_final.push(current_related_typo)}const related_types_node=common.create_dom_element({element_type:"span",class_name:"info_value related_types",inner_html:label+": "+ar_final.join(" | "),parent:fragment})}const ar_references=item.bibliography_data;if(fragment.appendChild(self.draw_bibliographic_reference(ar_references)),fragment.appendChild(self.default(item,"section_id",(function(value){const label=tstring.permanent_uri||"Permanent URI",url=page_globals.__WEB_ROOT_WEB__+"/type/"+value,full_url=page_globals.__WEB_BASE_URL__+url;return label+': <span class="uri">'+full_url+"</span>"}))),item.uri&&item.uri.length>0)for(let i=0;i<item.uri.length;i++){const el=item.uri[i];fragment.appendChild(self.default(item,"section_id",(function(value){const label=tstring.uri||"URI";return label+" "+el.label+': <span class="uri"><a href="'+el.value+'" target="_blank">'+el.value+"</a></span>"})))}if(item._coins_group&&item._coins_group.length>0){const data=item._coins_group.filter(el=>"1"!=el.typology_id);if(data.length>0){const coins_label=self.label(item,"coins");fragment.appendChild(coins_label);const coins_container=self.items_list(item,"items_list",data);coins_label.addEventListener("mouseup",event=>{event.preventDefault(),coins_container.classList.toggle("hide")}),fragment.appendChild(coins_container)}}let color=COLOR_PALETTE[0];item.denomination_data&&item.denomination_data.length&&item.denomination_data[0].color&&(color=item.denomination_data[0].color);const catalog_data=item.catalog,calculable=catalog_data.full_coins_reference_calculable?catalog_data.full_coins_reference_calculable:[],diameter=catalog_data.full_coins_reference_diameter_max?catalog_data.full_coins_reference_diameter_max.filter((v,i)=>v&&calculable[i]):[],weight=catalog_data.full_coins_reference_weight.filter((v,i)=>v&&calculable[i])?catalog_data.full_coins_reference_weight:[],axis=catalog_data.full_coins_reference_axis?catalog_data.full_coins_reference_axis.filter(v=>v):[],axis_counts=Array(12).fill(0);for(const hour of axis)axis_counts[hour%12]++;if(diameter.length||weight.length||axis.length){const analytics_div_wrapper=common.create_dom_element({element_type:"div",id:"type_analytics"});if(fragment.appendChild(analytics_div_wrapper),weight.length){const weight_wrapper=common.create_dom_element({element_type:"div",class_name:"type_analytics_component",parent:analytics_div_wrapper}),separator=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:weight_wrapper});common.create_dom_element({element_type:"div",class_name:"big_label",text_content:tstring.weight||"Weight",parent:separator});const chart_wrapper=common.create_dom_element({element_type:"div",class_name:"chart_wrapper",parent:weight_wrapper});self.weight_chat_wrapper=new minimal_boxvio_chart_wrapper(chart_wrapper,weight,{color:color,whiskers_quantiles:[10,90]}),self.weight_chat_wrapper.render()}if(diameter.length){const diameter_wrapper=common.create_dom_element({element_type:"div",class_name:"type_analytics_component",parent:analytics_div_wrapper}),separator=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:diameter_wrapper});common.create_dom_element({element_type:"div",class_name:"big_label",text_content:tstring.diameter||"Diameter",parent:separator});const chart_wrapper=common.create_dom_element({element_type:"div",class_name:"chart_wrapper",parent:diameter_wrapper});self.diameter_chart_wrapper=new minimal_boxvio_chart_wrapper(chart_wrapper,diameter,{color:color,whiskers_quantiles:[10,90]}),self.diameter_chart_wrapper.render()}if(axis.length){const axis_wrapper=common.create_dom_element({element_type:"div",class_name:"type_analytics_component",parent:analytics_div_wrapper}),separator=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:axis_wrapper});common.create_dom_element({element_type:"div",class_name:"big_label",text_content:tstring.die_position||"Die axis",parent:separator});const chart_wrapper=common.create_dom_element({element_type:"div",class_name:"chart_wrapper",parent:axis_wrapper});self.axis_chart_wrapper=new minimal_clock_chart_wrapper(chart_wrapper,axis_counts,{}),self.axis_chart_wrapper.render()}}if(item.ref_coins_findspots_data&&item.ref_coins_findspots_data.length>0||item.ref_coins_hoard_data&&item.ref_coins_hoard_data.length>0){const label=tstring.findspots+"/"+tstring.hoards+"/"+tstring.mints;fragment.appendChild(self.label(item,label)),fragment.appendChild(self.hoards_and_findspots(item,label))}const row_wrapper=common.create_dom_element({element_type:"div",class_name:"row_wrapper"});return row_wrapper.appendChild(fragment),row_wrapper},dedalo_link:function(item,section_tipo){const dedalo_link=common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",inner_html:item.section_id+" <small>("+section_tipo+")</small>",href:"/dedalo/lib/dedalo/main/?t="+section_tipo+"&id="+item.section_id});return dedalo_link.setAttribute("target","_blank"),dedalo_link},default:function(item,name,fn){const line=common.create_dom_element({element_type:"div",class_name:"info_line "+name});if(item[name]&&item[name].length>0){const searchTerms=["design_obverse","design_reverse","symbol_reverse","symbol_obverse"],item_text="function"==typeof fn?fn(item[name]):page.remove_gaps(item[name]," | ");if(searchTerms.includes(name)){const psqo={$and:[{id:name,q:item[name],op:"="}]},safe_psqo=psqo_factory.build_safe_psqo(psqo),parse_psqo=psqo_factory.encode_psqo(safe_psqo),catalog_url=page_globals.__WEB_ROOT_WEB__+"/catalog/?psqo="+parse_psqo,prompt_label=common.create_dom_element({element_type:"a",class_name:"info_value underline-text",inner_html:item_text.trim(),href:catalog_url,parent:line})}else common.create_dom_element({element_type:"span",class_name:"info_value",inner_html:item_text.trim(),parent:line})}return line},label:function(item,name){const line=common.create_dom_element({element_type:"div",class_name:"info_line separator "+name});return common.create_dom_element({element_type:"div",class_name:"big_label",text_content:tstring[name]||name,parent:line}),line},catalog_hierarchy:function(item,name){const line=common.create_dom_element({element_type:"div",class_name:"info_line inline "+name}),catalog=item.catalog;if(catalog&&Object.keys(catalog).length>0&&catalog.constructor===Object){const parents=catalog.parents,parents_ordered=[];for(let i=0;i<parents.length&&(parents_ordered.push(parents[i]),"mints"!==parents[i].term_table);i++);for(let i=parents_ordered.length-1;i>=0;i--){if("mints"===parents_ordered[i].term_table){const mint_section_id=parents_ordered[i].term_data?JSON.parse(parents_ordered[i].term_data)[0]:"",link=common.create_dom_element({element_type:"a",class_name:"breadcrumb link link_mint",href:page_globals.__WEB_ROOT_WEB__+"/mint/"+mint_section_id,target:"_blank",text_content:parents_ordered[i].term,parent:line})}else common.create_dom_element({element_type:"span",class_name:"breadcrumb "+parents_ordered[i].term_table,text_content:parents_ordered[i].term,parent:line});common.create_dom_element({element_type:"span",class_name:"breadcrumb_symbol",text_content:" > ",parent:line})}const mint_number=catalog.ref_mint_number?catalog.ref_mint_number+"/":"";common.create_dom_element({element_type:"span",class_name:"breadcrumb",text_content:page_globals.OWN_CATALOG_ACRONYM+" "+mint_number+catalog.term,parent:line})}return line},creators:function(item,name){const line=common.create_dom_element({element_type:"div",class_name:"info_line "+name});if(item.creators_data&&item.creators_data.length>0){const data=JSON.parse(item.creators_data),ar_names=item.creators_names?item.creators_names.split(" | "):[],ar_surnames=item.creators_surnames?item.creators_surnames.split(" | "):[],ar_roles=item.creators_roles?item.creators_roles.split("|"):[],text_creators=[],data_length=data.length;for(var i=0;i<data_length;i++){const name=ar_names[i]?ar_names[i]:"",surname=ar_surnames[i]?ar_surnames[i]:"",rol=ar_roles[i]?"("+ar_roles[i]+")":"",creator_name=name+" "+surname,creator=creator_name.trim()+" "+rol;text_creators.push(creator.trim())}common.create_dom_element({element_type:"span",class_name:"creators",text_content:text_creators.join(" | "),parent:line})}return line},image:function(item,name){const self=this,line=common.create_dom_element({element_type:"div",class_name:"info_line inline "+name});if(item[name]&&item[name].length>0){const url=item[name],image_link=common.create_dom_element({element_type:"a",class_name:"image_link",href:url,parent:line});common.create_dom_element({element_type:"img",class_name:"image",src:url,title:item.number,dataset:{caption:self.type+" | "+self.equivalents},parent:image_link})}return line},identify_coin:function(item,name){},id_line:function(item,name){const self=this,line=common.create_dom_element({element_type:"div",class_name:"info_line "+name}),ar_nodes=[];if(item[name="catalogue"]&&item[name].length>0){const mint_number=item.mint_number?item.mint_number+"/":"",item_text=item[name]+" "+mint_number+item.number;self.type=item_text;const node=common.create_dom_element({element_type:"span",class_name:"info_value "+name,text_content:item_text});ar_nodes.push(node)}if(item[name="denomination"]&&item[name].length>0){const item_text=item[name],node=common.create_dom_element({element_type:"span",class_name:"info_value "+name,text_content:item_text});ar_nodes.push(node),self.create_float_prompt(item,node,"denomination_data")}if(item[name="material"]&&item[name].length>0){const beats=page.split_data(item[name]," | "),item_text=beats.filter(Boolean).join(", ");var material_node=common.create_dom_element({element_type:"span",class_name:"info_value "+name,text_content:item_text});ar_nodes.push(material_node)}if(self.create_float_prompt(item,material_node,"material_data"),name="averages",item.averages_weight&&item.averages_weight.length>0){const weight_text=item.averages_weight?item.averages_weight.replace(".",",")+" g ("+item.total_weight_items+")":"",diameter_text=item.averages_diameter?"; "+item.averages_diameter.replace(".",",")+" mm ("+item.total_diameter_items+")":"",node=common.create_dom_element({element_type:"span",class_name:"info_value "+name,text_content:weight_text+diameter_text});ar_nodes.push(node)}const ar_nodes_length=ar_nodes.length;for(let i=0;i<ar_nodes_length;i++)i>0&&i<ar_nodes_length&&common.create_dom_element({element_type:"span",class_name:"info_value separator",text_content:" | ",parent:line}),line.appendChild(ar_nodes[i]);return line},items_list:function(item,name,data){const self=this,line=common.create_dom_element({element_type:"div",class_name:"info_line "+name}),coins_group_length=data.length;for(let i=0;i<coins_group_length;i++){const el=data[i],coinsLenght=el.coins?el.coins.length:0;if(coinsLenght<1)continue;if(1==el.typology_id)continue;const typology_name=el.typology;common.create_dom_element({element_type:"div",class_name:"medium_label",text_content:typology_name+" ("+coinsLenght+")",parent:line});const typology_coins=common.create_dom_element({element_type:"div",class_name:"coins_list typology_coins gallery",parent:line}),coins=el.coins,coins_length=coins.length;for(let j=0;j<coins_length;j++){const coin_section_id=coins[j],coin_data=item.ref_coins_union.find(element=>element.section_id==coin_section_id);if(coin_data){const coin_node=self.draw_coin(coin_data);typology_coins.appendChild(coin_node)}}}return line},draw_coin:function(data){const self=this;function load_hires(){this.removeEventListener("load",load_hires,!1);const image=this,hires=this.hires;setTimeout((function(){image.src=hires}),1e3)}const wrapper=common.create_dom_element({element_type:"div",class_name:"sorted_coin"}),images=common.create_dom_element({element_type:"div",class_name:"images_wrapper",parent:wrapper}),image_link_obverse=common.create_dom_element({element_type:"a",class_name:"image_link",href:data.image_obverse,parent:images}),image_obverse=common.create_dom_element({element_type:"img",src:data.image_obverse_thumb,title:data.section_id,loading:"lazy",parent:image_link_obverse});image_obverse.hires=data.image_obverse,image_obverse.addEventListener("load",load_hires,!1);const image_link_reverse=common.create_dom_element({element_type:"a",class_name:"image_link",href:data.image_reverse,parent:images}),image_reverse=common.create_dom_element({element_type:"img",src:data.image_reverse_thumb,title:data.section_id,loading:"lazy",parent:image_link_reverse});if(image_reverse.hires=data.image_reverse,image_reverse.addEventListener("load",load_hires,!1),data.collection&&data.collection.length>0){const collection_former=data.former_collection&&data.former_collection.length>0?data.collection+" ("+data.former_collection+")":data.collection,collection_label=data.number&&data.number.length>0?collection_former+" "+data.number:collection_former;image_obverse.setAttribute("data-caption",collection_label),image_reverse.setAttribute("data-caption",collection_label),common.create_dom_element({element_type:"div",class_name:"golden-color",inner_html:collection_label,parent:wrapper})}function draw_auction(data,parent,class_name,prepend){if(data.name.length<1)return;let auctionGalleryAttributes="";const line=common.create_dom_element({element_type:"div",class_name:"line_full",parent:parent});return data.name&&(auctionGalleryAttributes+=prepend+" "+data.name,common.create_dom_element({element_type:"span",class_name:class_name+" golden-color",inner_html:prepend+" "+data.name,parent:line})),data.date&&(auctionGalleryAttributes+=" "+data.date,common.create_dom_element({element_type:"span",class_name:class_name+" golden-color",inner_html:" "+data.date,parent:line})),data.number&&(auctionGalleryAttributes+=", "+data.number,common.create_dom_element({element_type:"span",class_name:class_name+" golden-color",inner_html:", "+data.number,parent:line})),data.lot&&(auctionGalleryAttributes+=", "+(tstring.lot||"lot")+" "+data.lot,common.create_dom_element({element_type:"span",class_name:class_name+" golden-color",inner_html:", "+(tstring.lot||"lot")+" "+data.lot,parent:line})),image_obverse.setAttribute("data-caption",auctionGalleryAttributes),image_reverse.setAttribute("data-caption",auctionGalleryAttributes),!0}if(data.photographer){const currentAttr=image_obverse.dataset.caption||"";image_obverse.setAttribute("data-caption",currentAttr+'<spam> | </spam> <i class="fa fa-camera"></i> '+data.photographer)}if(data.ref_auction_group)for(let i=0;i<data.ref_auction_group.length;i++)data.ref_auction_group[i].lot=data.number,draw_auction(data.ref_auction_group[i],wrapper,"identify_coin","");if(data.ref_related_coin_auction_group)for(let i=0;i<data.ref_related_coin_auction_group.length;i++)data.ref_related_coin_auction_group[i].lot=data.number,draw_auction(data.ref_related_coin_auction_group[i],wrapper,"identify_coin","= ");const ar_beats=[];data.weight&&data.weight.length>0&&ar_beats.push(data.weight.replace(".",",")+" g"),data.diameter&&data.diameter.length>0&&ar_beats.push(data.diameter.replace(".",",")+" mm"),data.dies&&data.dies.length>0&&ar_beats.push(data.dies+" h");const size_text=ar_beats.join("; ");common.create_dom_element({element_type:"div",class_name:"",inner_html:size_text,parent:wrapper});const ar_find=[];let label="";if(data.hoard){const hoard=data.hoard_place?data.hoard+" ("+data.hoard_place+")":data.hoard;label=(tstring.hoard||"Hoard")+": ",ar_find.push(hoard)}if(data.findspot){const findspot=data.findspot_place?data.findspot+" ("+data.findspot_place+")":data.findspot;label=(tstring.findspot||"Findspot")+": ",ar_find.push(findspot)}const find_text=ar_find.join(" | ");if(common.create_dom_element({element_type:"div",class_name:"",inner_html:label+find_text,parent:wrapper}),data.public_info&&data.public_info.length>0&&common.create_dom_element({element_type:"div",inner_html:data.public_info,parent:wrapper}),data.technique&&data.technique.length>0){const label=(tstring.technique||"Technique")+": ";common.create_dom_element({element_type:"div",inner_html:label+data.technique,parent:wrapper})}const countermarks=common.create_dom_element({element_type:"div",class_name:"countermarks_wrapper",parent:wrapper});data.countermark_obverse&&data.countermark_obverse.length>0&&common.create_dom_element({element_type:"span",class_name:"countermark_obverse",inner_html:data.countermark_obverse,parent:countermarks}),data.countermark_reverse&&data.countermark_reverse.length>0&&common.create_dom_element({element_type:"span",class_name:"countermark_reverse",inner_html:data.countermark_reverse,parent:countermarks});const references_container=common.create_dom_element({element_type:"div",class_name:"references",parent:wrapper}),ar_references=data.bibliography_data;if(ar_references&&ar_references.length>0&&"object"==typeof ar_references[0]){const biblio_node=self.draw_bibliographic_reference(ar_references);biblio_node&&references_container.appendChild(biblio_node)}const uri=page_globals.__WEB_ROOT_WEB__+"/coin/"+data.section_id,full_url=page_globals.__WEB_BASE_URL__+uri,uri_text='<a class="icon_link" target="_blank" href="'+uri+'"> '+page_globals.OWN_CATALOG_ACRONYM+" </a>";if(common.create_dom_element({element_type:"span",class_name:"uri-text",inner_html:uri_text,parent:wrapper}),data.uri&&data.uri.length>0)for(let i=0;i<data.uri.length;i++){const el=data.uri[i],label=el.label||"URI",uri_text='<a class="icon_link info_value" href="'+el.value+'" target="_blank"> '+el.label+"</a>";common.create_dom_element({element_type:"span",class_name:"",inner_html:uri_text,parent:wrapper})}return wrapper},draw_bibliographic_reference:function(data){const bib_fragment=new DocumentFragment,ref_biblio=data,ref_biblio_length=ref_biblio?ref_biblio.length:0;for(let i=0;i<ref_biblio_length;i++){const biblio_row_node=biblio_row_fields.render_row_bibliography(ref_biblio[i]),biblio_row_wrapper=common.create_dom_element({element_type:"div",class_name:"bibliographic_reference",parent:bib_fragment});biblio_row_wrapper.appendChild(biblio_row_node)}return bib_fragment},hoards_and_findspots:function(item,name){SHOW_DEBUG;const self=this,line=common.create_dom_element({element_type:"div",id:"findspots",class_name:"info_line "+name}),map_container=common.create_dom_element({element_type:"div",class_name:"map_container map",parent:line});function draw_coin_inside(data,container){const wrapper=common.create_dom_element({element_type:"div",class_name:"find_coin",parent:container}),images=common.create_dom_element({element_type:"div",class_name:"images_wrapper",parent:wrapper}),image_link_obverse=common.create_dom_element({element_type:"a",class_name:"image_link",href:data.image_obverse,parent:images}),image_obverse=common.create_dom_element({element_type:"img",src:data.image_obverse,title:data.section_id,dataset:{caption:self.type+" | "+self.equivalents},parent:image_link_obverse});image_obverse.loading="lazy";const image_link_reverse=common.create_dom_element({element_type:"a",class_name:"image_link",href:data.image_reverse,parent:images}),image_reverse=common.create_dom_element({element_type:"img",src:data.image_reverse,title:data.section_id,dataset:{caption:self.type+" | "+self.equivalents},parent:image_link_reverse});image_reverse.loading="lazy";const info=common.create_dom_element({element_type:"div",class_name:"info_wrapper",parent:wrapper});common.create_dom_element({element_type:"div",class_name:"",inner_html:data.collection,parent:info});const ar_beats=[];data.weight&&data.weight.length>0&&ar_beats.push(data.weight.replace(".",",")+" g"),data.diameter&&data.diameter.length>0&&ar_beats.push(data.diameter.replace(".",",")+" mm"),data.dies&&data.dies.length>0&&ar_beats.push(data.dies+" h");const size_text=ar_beats.join("; ");common.create_dom_element({element_type:"div",class_name:"",inner_html:size_text,parent:info});const uri=page_globals.__WEB_ROOT_WEB__+"/coin/"+data.section_id,full_uri=page_globals.__WEB_BASE_URL__+uri,uri_text='<a class="icon_link" target="_blank" href="'+uri+'"> '+page_globals.OWN_CATALOG_ACRONYM+" </a>";if(common.create_dom_element({element_type:"span",class_name:"",inner_html:uri_text,parent:info}),data.uri&&data.uri.length>0)for(let i=0;i<data.uri.length;i++){const el=data.uri[i],label=el.label||"URI",uri_text='<a class="icon_link info_value" href="'+el.value+'" target="_blank"> '+el.label+"</a>";common.create_dom_element({element_type:"span",class_name:"",inner_html:uri_text,parent:info})}common.create_dom_element({element_type:"div",class_name:"",inner_html:data.hoard,parent:info});const references_container=common.create_dom_element({element_type:"div",class_name:"references",parent:info}),ar_references=data.bibliography_data;references_container.appendChild(self.draw_bibliographic_reference(ar_references))}const map_data=[],findspots_solved=[],hoards_solved=[],hoards_data=item.ref_coins_hoard_data,hoards_data_length=hoards_data.length;if(hoards_data_length){const hoard_label=self.label(item,tstring.hoards);line.appendChild(hoard_label);const hoard_container=common.create_dom_element({element_type:"div",class_name:"hoard_container",parent:line});hoard_label.addEventListener("mouseup",event=>{event.preventDefault(),hoard_container.classList.toggle("hide")});for(let i=0;i<hoards_data_length;i++){const hoard=hoards_data[i],coins=JSON.parse(hoard.coins)||[],coins_length=coins.length;if(coins_length<1){console.warn("! Skipped hoard without zero coins :",hoards_data);continue}if(hoards_solved.find(section_id=>section_id==hoard.section_id))continue;const wrapper=common.create_dom_element({element_type:"div",class_name:"find_wrapper hoard",parent:hoard_container});common.create_dom_element({element_type:"span",inner_html:" "+(hoard.name||"")+" ("+(hoard.place||"")+") ",parent:wrapper});const items=common.create_dom_element({element_type:"span",text_content:" | ",parent:wrapper}),typology_coins=common.create_dom_element({element_type:"div",class_name:"find_coins hoard gallery",parent:hoard_container}),ar_coins=[];for(let j=0;j<coins_length;j++){const coin_section_id=coins[j],current_coin=item.coin_references.find(el=>el.section_id==coin_section_id);current_coin&&(draw_coin_inside(current_coin,typology_coins),ar_coins.push(coin_section_id))}items.innerHTML=items.innerHTML+ar_coins.length+" "+(tstring.of||"of")+" "+coins_length+" "+(tstring.coins||"coins");const hoard_data_map=JSON.parse(hoard.map);hoard_data_map&&map_data.push({section_id:hoard.section_id,name:hoard.name,place:hoard.place,georef:hoard.georef,data:hoard_data_map,items:ar_coins.length,total_items:coins_length,type:"hoard",marker_icon:page.maps_config.markers.hoard}),hoards_solved.push(hoard.section_id)}}const findspots_data=item.ref_coins_findspots_data,findspots_data_length=findspots_data.length;if(findspots_data_length){const findspots_label=self.label(item,tstring.findspots);line.appendChild(findspots_label);const findspots_container=common.create_dom_element({element_type:"div",class_name:"findspots_container",parent:line});findspots_label.addEventListener("mouseup",event=>{event.preventDefault(),findspots_container.classList.toggle("hide")});for(let i=0;i<findspots_data_length;i++){const findspot=findspots_data[i],coins=JSON.parse(findspot.coins)||[],coins_length=coins.length;if(coins_length<1){console.warn("! Skipped findspot without zero coins :",findspots_data);continue}if(findspots_solved.find(section_id=>section_id==findspot.section_id))continue;const wrapper=common.create_dom_element({element_type:"div",class_name:"find_wrapper findspot",parent:findspots_container});common.create_dom_element({element_type:"span",inner_html:" "+(findspot.name||"")+" ("+(findspot.place||"")+") ",parent:wrapper});const items=common.create_dom_element({element_type:"span",text_content:" | ",parent:wrapper}),typology_coins=common.create_dom_element({element_type:"div",class_name:"find_coins findspot gallery",parent:findspots_container}),ar_coins=[];for(let j=0;j<coins_length;j++){const coin_section_id=coins[j],current_coin=item.coin_references.find(el=>el.section_id==coin_section_id);current_coin&&(draw_coin_inside(current_coin,typology_coins),ar_coins.push(coin_section_id))}const findspot_data_map=JSON.parse(findspot.map);findspot_data_map&&map_data.push({section_id:findspot.section_id,name:findspot.name,place:findspot.place,georef:findspot.georef,data:findspot_data_map,items:ar_coins.length,total_items:coins_length,type:"findspot",marker_icon:page.maps_config.markers.findspot}),items.innerHTML=items.innerHTML+ar_coins.length+" "+(tstring.of||"of")+" "+coins_length+" "+(tstring.coins||"coins"),findspots_solved.push(findspot.section_id)}}const mint_data=item.mint_data||[],mint_data_length=mint_data.length;if(mint_data_length>0)for(let i=0;i<mint_data_length;i++){const mint=mint_data[i],coins=JSON.parse(mint.relations_coins)||[],coins_length=coins.length,ar_coins=[];for(let j=0;j<coins_length;j++){const coin_section_id=coins[j],current_coin=item.coin_references.find(el=>el.section_id==coin_section_id);current_coin&&ar_coins.push(coin_section_id)}const mint_data_map=JSON.parse(mint.map);mint_data_map&&map_data.push({section_id:mint.section_id,name:mint.name,place:mint.place,georef:mint.georef,data:mint_data_map,items:ar_coins.length,total_items:coins_length,type:"mint",marker_icon:page.maps_config.markers.mint})}if(map_data.length>0){function draw_map(){self.caller.draw_map({container:map_container,map_position:null,map_data:map_data})}common.when_in_dom(map_container,draw_map)}else map_container.remove();return line},mint:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line mint"});if(item.mint&&item.mint.length>0){common.create_dom_element({element_type:"label",class_name:"",text_content:tstring.mint||"Mint",parent:line});const mint_text=row_object.mint;common.create_dom_element({element_type:"span",class_name:"info_value",text_content:mint_text,parent:line})}return line},authors_alt:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line authors_alt"});if(item.authors_alt&&item.authors_alt.length>0){const authors_alt=item.authors_alt||"",final_authors_alt=" ("+authors_alt+"). ";common.create_dom_element({element_type:"div",class_name:"info_value authors_alt",text_content:final_authors_alt,parent:line})}return line},publication_date:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line publication_date"});if(item.publication_date){const ar_date=item.publication_date.split("-");let final_date=parseInt(ar_date[0]);ar_date[1],parseInt(ar_date[1])>0&&(final_date=final_date+"-"+parseInt(ar_date[1])),ar_date[2],parseInt(ar_date[2])>0&&(final_date=final_date+"-"+parseInt(ar_date[2])),final_date=" ("+final_date+"). ",common.create_dom_element({element_type:"div",class_name:"info_value",text_content:final_date,parent:line}),line.classList.remove("hide")}return line},title:function(item){const typology=this.get_typology(item),title=item.title||"",title_style="1"==typology||"20"==typology||"28"==typology||"30"==typology||"32"==typology?" italic":"",line=common.create_dom_element({element_type:"div",class_name:"info_line title"}),title_final=" "+title+". ";return common.create_dom_element({element_type:"div",class_name:""+title_style,text_content:title_final,parent:line}),line},editor:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line editor"});if(item.editor&&item.editor.length>0){const en=tstring.en||"En",editor=" "+en+" "+item.editor+", ";common.create_dom_element({element_type:"div",class_name:"info_value",text_content:editor,parent:line})}return line},title_secondary:function(item){const title_secondary=item.title_secondary||"",line=common.create_dom_element({element_type:"div",class_name:"info_line row_title"});if(title_secondary.length>0){const title_secondary_final=" "+title_secondary+" ";common.create_dom_element({element_type:"div",class_name:"title_secondary italic",text_content:title_secondary_final,parent:line})}return line},magazine:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line magazine"});if(item.magazine&&item.magazine.length>0){const magazine_final=" "+item.magazine+", ";common.create_dom_element({element_type:"div",class_name:"info_value italic",text_content:magazine_final,parent:line})}return line},serie:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line serie"});if(item.serie&&item.serie.length>0){const serie_text=!item.copy||item.copy.length<1?" "+item.serie+", ":" "+item.serie;common.create_dom_element({element_type:"div",class_name:"info_value italic",text_content:serie_text,parent:line})}return line},copy:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line copy"});if(item.copy&&item.copy.length>0){const copy=" ("+item.copy+"), ";common.create_dom_element({element_type:"div",class_name:"info_value",text_content:copy,parent:line})}return line},physical_description:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line physical_description"});if(item.physical_description&&item.physical_description.length>0){const physical_description=" "+item.physical_description+". ";common.create_dom_element({element_type:"div",class_name:"info_value",text_content:physical_description,parent:line})}return line},editorial:function(item){const self=this,line=common.create_dom_element({element_type:"div",class_name:"info_line editorial"});if(item.editorial&&item.editorial.length>0){const editorial=" "+item.editorial+". ";common.create_dom_element({element_type:"div",class_name:"info_value",text_content:editorial,parent:line})}return line},url:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line url"}),url_data=item.url_data;if(url_data&&url_data.length>0){const ar_url_data=JSON.parse(url_data),ar_url_data_length=ar_url_data.length;for(let i=0;i<ar_url_data_length;i++){const url_item=ar_url_data[i],title=url_item.title&&url_item.title.length>1?url_item.title:url_item.iri,link=common.create_dom_element({element_type:"a",class_name:"url_data",title:title,text_content:title,href:url_item.iri,parent:line});link.setAttribute("target","_blank"),!(i%2)&&i<ar_url_data_length&&ar_url_data_length>1&&common.create_dom_element({element_type:"span",class_name:"separator",text_content:" | ",parent:line})}}return line},place:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line place"});return item.place&&item.place.length>0&&common.create_dom_element({element_type:"div",class_name:"info_value",text_content:item.place,parent:line}),line},descriptors:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line descriptors"});return item.descriptors&&item.descriptors.length>0&&common.create_dom_element({element_type:"div",class_name:"info_value",text_content:item.descriptors,parent:line}),line},typology_name:function(item){const line=common.create_dom_element({element_type:"div",class_name:"info_line typology_name"});return item.typology_name&&item.typology_name.length>0&&common.create_dom_element({element_type:"div",class_name:"info_value",text_content:item.typology_name,parent:line}),line},create_float_prompt:function(item,parentNode,data_ref){if(item[data_ref]&&item[data_ref].length>0){parentNode.classList.add("active-pointer"),parentNode.classList.add("underline-text");const main_node=document.getElementById("main"),float_prompt=common.create_dom_element({element_type:"div",class_name:"float-prompt hide",parent:main_node}),url_label="material_data"===data_ref?item.material:item[data_ref][0].term,psqo=[{$and:[{field:item[data_ref][0].table,value:url_label,op:"="}]}],parse_psqo=psqo_factory.encode_psqo(psqo),catalog_url=page_globals.__WEB_ROOT_WEB__+"/catalog/?psqo="+parse_psqo,prompt_label=common.create_dom_element({element_type:"a",class_name:"prompt-label underline-text",inner_html:item[data_ref][0].term,href:catalog_url,parent:float_prompt}),close_buttom=common.create_dom_element({element_type:"div",class_name:"close-buttom",parent:float_prompt});if(item[data_ref][0].definition){const item_description=common.create_dom_element({element_type:"p",class_name:"prompt-description",inner_html:item[data_ref][0].definition,parent:float_prompt})}if(item[data_ref][0].iri.length>0){const uris=page.split_data(item[data_ref][0].iri," | ");for(let i=0;i<uris.length;i++){const eachUrl=common.create_dom_element({element_type:"a",class_name:"image_link underline-text",target:"_blank",href:uris[i],inner_html:uris[i],parent:float_prompt})}}parentNode.addEventListener("click",(function(e){const float_prompts_list=document.getElementsByClassName("float-prompt");for(let i=0;i<float_prompts_list.length;i++)float_prompts_list[i].classList.contains("hide")||float_prompts_list[i].classList.add("hide");float_prompt.style.left=e.clientX+"px",float_prompt.style.top=e.clientY+"px",float_prompt.classList.remove("hide")})),close_buttom.addEventListener("click",(function(){float_prompt.classList.add("hide")}))}}};