"use strict";var type={search_options:{},map:null,export_data_container:null,section_id:null,set_up:function(options){const self=this;self.export_data_container=options.export_data_container,self.section_id=options.section_id;const export_data_buttons=page.render_export_data_buttons();self.export_data_container.appendChild(export_data_buttons),self.export_data_container.classList.add("hide");const contact_form_button=page.create_suggestions_button();return self.export_data_container.appendChild(contact_form_button),void 0!==self.section_id&&self.get_row_data({section_id:self.section_id}).then((function(response){const container=document.getElementById("row_detail");for(;container.hasChildNodes();)container.removeChild(container.lastChild);const type=response.result.find(item=>"type"===item.id),catalog=response.result.find(item=>"catalog"===item.id);if(void 0!==type.result[0]){const row=type.result[0],catalog_rows=page.parse_catalog_data(catalog.result)[0]||null;console.log(),row.catalog=catalog_rows,page.parse_type_data(row),event_manager.publish("data_request_done",{request_body:null,result:row,export_data_parser:page.export_parse_type_data}),self.list_row_builder(row).then((function(row_wrapper){container.appendChild(row_wrapper);const embeddedGallery=row_wrapper.querySelectorAll("a");if(embeddedGallery&&embeddedGallery.length>0){row_wrapper.querySelector(".identify_coin_wrapper").remove();const newGallery=Object.create(image_gallery);newGallery.set_up_embedded({galleryNode:embeddedGallery,galleryPrimId:"embedded-gallery-id",containerId:"embedded-gallery"})}const images_gallery_containers=row_wrapper.querySelectorAll(".gallery");if(images_gallery_containers)for(let i=0;i<images_gallery_containers.length;i++)page.activate_images_gallery(images_gallery_containers[i]);self.export_data_container.classList.remove("hide")}))}})),!0},get_row_data:function(options){const section_id=options.section_id,lang=options.lang||page_globals.WEB_CURRENT_LANG_CODE,ar_calls=[];ar_calls.push({id:"type",options:{dedalo_get:"records",table:"types",ar_fields:["*"],lang:lang,sql_filter:"section_id = "+parseInt(section_id),count:!1,resolve_portals_custom:{bibliography_data:"bibliographic_references",ref_coins_union:"coins",coin_references:"coins","coins.bibliography_data":"bibliographic_references",ref_coins_findspots_data:"findspots","findspots.bibliography_data":"bibliographic_references",ref_coins_hoard_data:"hoards","hoards.bibliography_data":"bibliographic_references",denomination_data:"denomination",material_data:"material",related_types_data:"types",mint_data:"mints"}}});const ar_fields=["section_id","term","term_data","term_table","term_section_tipo","parents","ref_mint_number","full_coins_reference_calculable","full_coins_reference_diameter_max","full_coins_reference_weight","full_coins_reference_axis"];ar_calls.push({id:"catalog",options:{dedalo_get:"records",table:"catalog",ar_fields:ar_fields,lang:lang,count:!1,sql_filter:"term_data='[\""+parseInt(section_id)+"\"]' AND term_table='types'",resolve_portals_custom:{parents:"catalog"}}});const js_promise=data_manager.request({body:{dedalo_get:"combi",ar_calls:ar_calls}});return js_promise},list_row_builder:function(row){const self=this;return new Promise((function(resolve){self.parse_publication(row.bibliography_data);const coins_length=row.ref_coins_union.length;for(let i=0;i<coins_length;i++){const item=row.ref_coins_union[i];self.parse_publication(item.bibliography_data)}const findspots_length=row.ref_coins_findspots_data.length;for(let i=0;i<findspots_length;i++){const item=row.ref_coins_findspots_data[i];self.parse_publication(item.bibliography_data)}const hoards_length=row.ref_coins_hoard_data.length;for(let i=0;i<hoards_length;i++){const item=row.ref_coins_hoard_data[i];self.parse_publication(item.bibliography_data)}self.parse_ordered_coins(row),console.log(row),type_row_fields_min.type_row_fields.caller=self;const row_node=type_row_fields_min.type_row_fields.draw_item(row);resolve(row_node)}))},parse_publication:function(data){return page.parse_publication(data)},parse_ordered_coins:function(row){const parsed_data=[],separator=" | ",typology_data=page.split_data(row.ref_coins_typology_data," | "),typology_data_length=typology_data.length,typology=page.split_data(row.ref_coins_typology," | "),ref_coins=page.split_data(row.ref_coins," | ");for(let i=0;i<typology_data_length;i++){const typology_id=typology_data[i]?JSON.parse(typology_data[i])[0]:null,current_coins=ref_coins[i]?JSON.parse(ref_coins[i]):[],parsed_item={typology_id:typology_id,typology:typology[i]||null,coins:current_coins};parsed_data.push(parsed_item)}return row._coins_group=parsed_data,parsed_data},draw_map:function(options){const self=this,map_data=options.map_data,container=options.container,map_position=options.map_position,popup_data=options.popup_data;this.map=this.map||new map_factory,this.map.init({map_container:container,map_position:map_position,popup_builder:this.map_popup_builder,popup_options:page.maps_config.popup_options,source_maps:page.maps_config.source_maps,legend:page.render_map_legend});const map_data_clean=this.map_data(map_data,popup_data);return this.map.parse_data_to_map(map_data_clean,null).then((function(){container.classList.remove("hide_opacity")})),!0},map_data:function(data){const data_clean=[];for(let i=0;i<data.length;i++){const item={lat:parseFloat(data[i].data.lat),lon:parseFloat(data[i].data.lon),marker_icon:data[i].marker_icon||null,data:{section_id:data[i].section_id,name:data[i].name,place:data[i].place,type:data[i].type,items:data[i].items,total_items:data[i].total_items}};data_clean.push(item)}return data_clean},map_popup_builder:function(data){const data_group=data.group[0],title=data_group.name,total_items=data_group.total_items,items=data_group.items,section_id=data_group.section_id,popup_wrapper=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),popup_item=common.create_dom_element({element_type:"div",class_name:"popup_item",title:section_id,parent:popup_wrapper}),text_title=common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:title,parent:popup_item});if(total_items&&total_items>0){const description=tstring.items+": "+items+" "+(tstring.of||"of")+" "+total_items,text_description=common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:description,parent:popup_item})}return popup_wrapper}};