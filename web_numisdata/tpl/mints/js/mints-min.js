"use strict";var mints={search_options:{},form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,set_up:function(t){function e(t){n.pagination.offset=t,n.form_submit()}const n=this;n.form_container=t.form_container,n.rows_container=t.rows_container;const o=t.psqo;n.form=new form_factory;const i=n.render_form();if(n.form_container.appendChild(i),n.pagination={total:null,limit:10,offset:0,n_nodes:8},event_manager.subscribe("paginate",e),o&&o.length>1){const t=psqo_factory.decode_psqo(o);t&&(n.form.parse_psqo_to_form(t),n.form_submit(i,{scroll_result:!0}))}else n.pagination={total:null,offset:0},n.form_submit();return!0},render_form:function(){const t=this,e=new DocumentFragment,n=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"name",name:"name",label:tstring.mint||"Mint",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"mints"})}}),t.form.item_factory({id:"place",name:"place",label:tstring.place||"Place",q_column:"place",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"mints"})}}),t.form.item_factory({id:"indexation",name:"indexation",label:tstring.indexation||"Indexation",q_column:"indexation",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"mints"})}});const o=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e}),i=common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:o});i.addEventListener("click",function(e){e.preventDefault(),t.pagination={total:null,offset:0},t.form_submit()});const r=t.form.build_operators_node();return e.appendChild(r),t.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),t.form.node.appendChild(e),t.form.node},form_submit:function(){const t=this,e=t.form.node;if(!e)return new Promise(function(t){console.error("Error on submit. Invalid form_node.",e),t(!1)});const n=t.rows_container;return t.pagination.total?n.classList.add("loading"):page.add_spinner(n),new Promise(function(e){const o="mints",i=["*"],r=t.pagination.limit||0,a=t.pagination.offset||0,l=!0,s="name",m=t.form.build_filter(),c=[],_=t.form.parse_sql_filter(m,c),f=_?"("+_+")":null;SHOW_DEBUG;const u={dedalo_get:"records",table:o,ar_fields:i,sql_filter:f,limit:r,count:l,offset:a,order:s,process_result:null};data_manager.request({body:u}).then(function(o){const i=page.parse_mint_data(o.result),l=o.total;t.pagination.total=l,t.pagination.offset=a,i||(n.classList.remove("loading"),e(null)),function(){for(;n.hasChildNodes();)n.removeChild(n.lastChild);n.classList.remove("loading")}(),t.list=t.list||new list_factory,t.list.init({data:i,fn_row_builder:t.list_row_builder,pagination:!1,caller:t}),t.list.render_list().then(function(t){t&&n.appendChild(t),e(t)});const s=0===r&&0===a?Promise.resolve(i.map(t=>t.section_id)):(()=>{const t=Object.assign({},u);return t.limit=0,t.offset=0,t.count=!1,t.ar_fields=["section_id"],data_manager.request({body:t}).then(function(t){const e=t.result?t.result.map(t=>t.section_id):null;return e})})();s.then(function(){})});const d=document.querySelector(".rows_container");d&&d.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})},list_row_builder:function(t){return mints_rows.draw_item(t)}};