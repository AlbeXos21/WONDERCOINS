"use strict";var coins={form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,set_up:function(t){function e(t){o.pagination.offset=t,o.form_submit()}const o=this;o.form_container=t.form_container,o.rows_container=t.rows_container;const n=t.psqo;o.pagination={total:null,limit:100,offset:0,n_nodes:8},o.form=new form_factory;const i=o.render_form();if(o.form_container.appendChild(i),n&&n.length>1){const t=psqo_factory.decode_psqo(n);t&&(o.form.parse_psqo_to_form(t),o.form_submit(i,{scroll_result:!0}))}else o.form_submit();return event_manager.subscribe("paginate",e),!0},render_form:function(){const t=this,e=new DocumentFragment,o=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"mint_name",eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"collection",name:"collection",label:tstring.collection||"collection",q_column:"collection",eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"type_full_value",name:"type_full_value",q_column:"type_full_value",label:tstring.type||"type",value_split:" - ",q_splittable:!0,q_selected_eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!1,parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"material",name:"material",label:tstring.material||"Material",q_column:"material",eq:"LIKE",value_split:" | ",q_splittable:!0,q_selected_eq:"LIKE",eq_in:"%",eq_out:"%",parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"denomination",name:"denomination",label:tstring.denomination||"Denomination",q_column:"denomination",value_split:" | ",q_splittable:!0,q_selected_eq:"LIKE",eq_in:"%",eq_out:"%",parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"hoard",name:"hoard",label:tstring.hoard||"hoard",q_column:"hoard",eq:"LIKE",eq_in:"%",eq_out:"%",parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"findspot",name:"findspot",label:tstring.findspot||"findspot",q_column:"findspot",eq:"LIKE",eq_in:"%",eq_out:"%",parent:o,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}});const n=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e}),i=common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:n});i.addEventListener("click",function(e){e.preventDefault(),t.pagination={total:null,limit:100,offset:0,n_nodes:8},t.form_submit()});const a=t.form.build_operators_node();return e.appendChild(a),t.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),t.form.node.appendChild(e),t.form.node},form_submit:function(){const t=this,e=t.form.node;if(!e)return new Promise(function(t){console.error("Error on submit. Invalid form_node.",e),t(!1)});const o=t.rows_container;return t.pagination.total?o.classList.add("loading"):page.add_spinner(o),new Promise(function(e){const n="coins",i=["*"],a=t.pagination.limit,l=t.pagination.offset,r=!0,m="type IS NULL, type ASC",s=t.form.build_filter(),c=[],_=t.form.parse_sql_filter(s,c),f=_?"("+_+")":null;!0===SHOW_DEBUG&&console.log("-> coins form_submit sql_filter:",f),data_manager.request({body:{dedalo_get:"records",table:n,ar_fields:i,sql_filter:f,limit:a,count:r,offset:l,order:m,process_result:null,resolve_portals_custom:{image_obverse_data:"images"}}}).then(function(n){coins_row_fields.last_type=null;const i=page.parse_coin_data(n.result),a=n.total;t.pagination.total=a,t.pagination.offset=l,i||(o.classList.remove("loading"),e(null)),function(){for(;o.hasChildNodes();)o.removeChild(o.lastChild);o.classList.remove("loading")}(),t.list=t.list||new list_factory,t.list.init({data:i,fn_row_builder:t.list_row_builder,pagination:t.pagination,caller:t}),t.list.render_list().then(function(t){t&&o.appendChild(t),e(t)})});const u=document.querySelector(".rows_container");u&&u.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})},list_row_builder:function(t){return coins_row_fields.draw_item(t)}};