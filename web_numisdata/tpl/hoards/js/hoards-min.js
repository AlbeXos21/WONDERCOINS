"use strict";var hoards={form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,table:null,set_up:function(options){const self=this;self.form_container=options.form_container,self.rows_container=options.rows_container,self.table=options.table,self.form=new form_factory;const form_node=self.render_form();function paginate(offset){self.pagination.offset=offset,self.form_submit()}return self.form_container.appendChild(form_node),self.pagination={total:null,limit:15,offset:0,n_nodes:8},event_manager.subscribe("paginate",paginate),self.form_submit(),!0},render_form:function(){const self=this,fragment=new DocumentFragment,form_row=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:fragment});self.form.item_factory({id:"global_search",name:"global_search",label:tstring.global_search||"global_search",q_column:"name",eq:"MATCH",eq_in:"",eq_out:"",class_name:"global_search",parent:form_row,callback:function(form_item){const node_input=form_item.node_input,button_info=common.create_dom_element({element_type:"div",class_name:"search_operators_info",parent:node_input.parentNode});let operators_info;button_info.addEventListener("click",(function(event){if(event.stopPropagation(),operators_info)return operators_info.remove(),void(operators_info=null);operators_info=self.form.full_text_search_operators_info(),node_input.parentNode.appendChild(operators_info)})),window.addEventListener("click",(function(e){operators_info&&!node_input.contains(e.target)&&(operators_info.remove(),operators_info=null)}))}}),self.form.item_factory({id:"name",name:"name",label:tstring.name||"Name",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){const table="findspots"===self.table?"findspots":"hoards";self.form.activate_autocomplete({form_item:form_item,table:table})}}),self.form.item_factory({id:"place",name:"place",label:tstring.place||"Place",q_column:"place",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){const table="findspots"===self.table?"findspots":"hoards";self.form.activate_autocomplete({form_item:form_item,table:table})}}),self.form.item_factory({id:"typology",name:"typology",label:tstring.typology||"Typology",q_column:"typology",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){const table=(self.table,"publications");self.form.activate_autocomplete({form_item:form_item,table:table})}}),self.form.item_factory({id:"indexation",name:"indexation",label:tstring.indexation||"Indexation",q_column:"indexation",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){const table="findspots"===self.table?"findspots":"hoards";self.form.activate_autocomplete({form_item:form_item,table:table})}});const submit_group=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:fragment}),submit_button=common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:submit_group});submit_button.addEventListener("click",(function(e){e.preventDefault(),self.pagination={total:null,limit:15,offset:0,n_nodes:8},self.form_submit()}));const operators_node=self.form.build_operators_node();return fragment.appendChild(operators_node),self.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),self.form.node.appendChild(fragment),self.form.node},form_submit:function(){const self=this,form_node=self.form.node;if(!form_node)return new Promise((function(resolve){console.error("Error on submit. Invalid form_node.",form_node),resolve(!1)}));const rows_container=self.rows_container;return self.pagination.total?rows_container.classList.add("loading"):page.add_spinner(rows_container),new Promise((function(resolve){const table="findspots"===self.table?"findspots":"hoards",ar_fields=["*"],count=!0,order="name",resolve_portals_custom={bibliography_data:"bibliographic_references"},filter=self.form.build_filter(),group=[],parsed_filter=self.form.parse_sql_filter(filter,group),base_filter="(name != '' AND map != '')";let final_filter=base_filter;const sql_filter=parsed_filter?"("+parsed_filter+")":null;!0===SHOW_DEBUG&&console.log("-> coins form_submit sql_filter:",sql_filter),sql_filter&&(final_filter=base_filter+" AND "+sql_filter),console.log(sql_filter),data_manager.request({body:{dedalo_get:"records",table:table,ar_fields:ar_fields,sql_filter:final_filter,limit:0,count:!0,offset:0,order:order,process_result:null,resolve_portals_custom:resolve_portals_custom}}).then((function(api_response){console.log("--------------- api_response:",api_response);const data=page.parse_hoard_data(api_response.result),total=api_response.total,random=Math.floor(Math.random()*total);data||(rows_container.classList.remove("loading"),resolve(null)),function(){for(;rows_container.hasChildNodes();)rows_container.removeChild(rows_container.lastChild);rows_container.classList.remove("loading")}();const estructura=common.create_dom_element({element_type:"div",class_name:"grid-stack",parent:rows_container}),grid=GridStack.init(estructura),titulo=grid.addWidget({w:4,h:1,content:`${api_response.result[200].name}`}),contentDiv=titulo.querySelector(".grid-stack-item-content");contentDiv.id="titulo-ficha";const imagen_ident=grid.addWidget({w:4,h:2,content:`<img src="https://wondercoins.uca.es${api_response.result[200].identify_image}" alt="Imagen dinÃ¡mica" style="width:100%; height:100%; object-fit:cover; overflow: hidden;"`}),img_ident=imagen_ident.querySelector(".grid-stack-item-content");img_ident.id="img_ident";const map=new map_factory;grid.addWidget({w:4,h:10,content:""}),grid.addWidget({w:4,h:4,content:`${api_response.result[200].public_info}`});const ubicacion=grid.addWidget({w:2,h:2,content:""});let resultado={hallazgos:{datos:[]},cecas:{datos:[]},complejo:{datos:[]}};resultado.hallazgos.datos.push(api_response.result[200]),map.init({map_container:ubicacion,map_position:api_response.result[200].map,source_maps:page.maps_config.source_maps,result:resultado,findspot:!0}),grid.addWidget({w:2,h:2,content:""}),grid.addWidget({w:2,h:1,content:""}),grid.addWidget({w:2,h:1,content:""}),grid.addWidget({w:2,h:1,content:""}),grid.addWidget({w:2,h:1,content:""}),grid.addWidget({w:4,h:1,content:""}),grid.addWidget({w:8,h:4,content:`${api_response.result[200].public_info}`}),grid.addWidget({w:8,h:3,content:""}),grid.addWidget({w:4,h:3,content:""})}));const div_result=document.querySelector(".rows_container");div_result&&div_result.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))}};