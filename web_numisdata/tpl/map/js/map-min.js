"use strict";var map={form_container:null,rows_container:null,map_container:null,export_data_container:null,map_factory_instance:null,master_map_global_data:null,current_map_global_data:null,global_data:null,map_global_data:null,form:null,forn_node:null,map_config:null,set_up:function(options){SHOW_DEBUG;const self=this;self.form_container=options.form_container,self.map_container=options.map_container,self.rows_container=options.rows_container,self.export_data_container=options.export_data_container;const export_data_buttons=page.render_export_data_buttons();self.export_data_container.appendChild(export_data_buttons),self.export_data_container.classList.add("hide"),self.source_maps=[{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20},default:!0},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}}];let resultado={hallazgos:{datos:null},cecas:{datos:null},complejo:{datos:null}};async function cargarTodoYCrearMapa(){try{const hallazgos=await data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:"",limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});resultado.hallazgos.datos=hallazgos.result;const cecas=await data_manager.request({body:{dedalo_get:"records",table:"mints",ar_fields:["*"],sql_filter:"",limit:0,count:!0,offset:0,order:"name",process_result:null}});resultado.cecas.datos=cecas.result,self.map_factory_instance=new map_factory,self.map_factory_instance.init({map_container:self.map_container,map_position:[36.5297,-6.2924],source_maps:self.source_maps,result:resultado})}catch(error){console.error("Error cargando datos:",error)}}cargarTodoYCrearMapa(),self.form=new form_factory;const form_node=self.render_form();self.form_container.appendChild(form_node),self.set_config();const show_search_button=document.getElementById("search_icon");return show_search_button.addEventListener("mousedown",(function(){let new_showing_search;!0===self.map_config.showing_search?(form_node.classList.add("hide"),new_showing_search=!1):(form_node.classList.remove("hide"),new_showing_search=!0),self.set_config({showing_search:new_showing_search})})),!0===self.map_config.showing_search?form_node.classList.remove("hide"):form_node.classList.add("hide"),!0},set_config:function(options){const self=this,map_config=localStorage.getItem("map_config");if(map_config)self.map_config=JSON.parse(map_config);else{const map_config={showing_search:!1};localStorage.setItem("map_config",JSON.stringify(map_config)),self.map_config=map_config}if(options){for(const key in options)self.map_config[key]=options[key];localStorage.setItem("map_config",JSON.stringify(self.map_config))}return self.map_config},render_form:function(){const self=this,fragment=new DocumentFragment,form_row=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:fragment});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:form_row}),self.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"mint",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,q_selected_eq:"LIKE",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}}),self.form.item_factory({id:"collection",name:"collection",label:tstring.collection||"collection",q_column:"collection",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}}),self.form.item_factory({id:"findspot",name:"findspot",label:tstring.findspot||"findspot",q_column:"findspot",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}}),self.form.item_factory({id:"hoard",name:"hoard",label:tstring.hoard||"hoard",q_column:"hoard",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}}),self.form.item_factory({id:"material",name:"material",label:tstring.material||"Material",q_column:"material",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}}),self.form.item_factory({id:"denomination",name:"denomination",label:tstring.denomination||"Denomination",q_column:"denomination",eq:"LIKE",eq_in:"%",eq_out:"%",parent:form_row,callback:function(form_item){self.form.activate_autocomplete({form_item:form_item,table:"coins"})}});const submit_group=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:fragment}),submit_button=common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:submit_group});submit_button.addEventListener("click",(function(e){e.preventDefault(),self.form_submit()}));const operators_node=self.form.build_operators_node();return fragment.appendChild(operators_node),self.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),self.form.node.appendChild(fragment),self.form.node},form_submit:function(){const self=this,form_node=self.form.node;if(!form_node)return new Promise((function(resolve){console.error("Error on submit. Invalid form_node.",form_node),resolve(!1)}));for(;self.rows_container.hasChildNodes();)self.rows_container.removeChild(self.rows_container.lastChild);return self.map_container.classList.add("loading"),new Promise((function(resolve){const ar_fields=["section_id","mint_data","hoard_data","findspot_data","type_data"],filter=self.form.build_filter();console.log(self.form.form_items);const group=[],parsed_filter=self.form.parse_sql_filter(filter,group),sql_filter=parsed_filter?"("+parsed_filter+")":null;SHOW_DEBUG,data_manager.request({body:{dedalo_get:"records",table:"coins",ar_fields:ar_fields,sql_filter:sql_filter+" AND type_data IS NOT NULL",limit:0,count:!1,offset:0,order:"section_id ASC",process_result:null}}).then((function(api_response){console.log("--------------- form_submit api_response:",api_response),api_response.result,self.map_container.classList.remove("loading"),resolve(!0)}))}))}};