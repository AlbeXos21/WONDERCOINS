"use strict";var map={form_container:null,rows_container:null,map_container:null,export_data_container:null,map_factory_instance:null,master_map_global_data:null,current_map_global_data:null,global_data:null,map_global_data:null,form:null,forn_node:null,map_config:null,set_up:function(e){SHOW_DEBUG;const t=this;t.form_container=e.form_container,t.map_container=e.map_container,t.rows_container=e.rows_container,t.export_data_container=e.export_data_container;const n=page.render_export_data_buttons();t.export_data_container.appendChild(n),t.export_data_container.classList.add("hide"),t.source_maps=[{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20},default:!0},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}}];let o={hallazgos:{datos:null},cecas:{datos:null},complejo:{datos:null}};!async function(){try{const e=await data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:"",limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});o.hallazgos.datos=e.result;const n=await data_manager.request({body:{dedalo_get:"records",table:"mints",ar_fields:["*"],sql_filter:"",limit:0,count:!0,offset:0,order:"name",process_result:null}});o.cecas.datos=n.result,t.map_factory_instance=new map_factory,t.map_factory_instance.init({map_container:t.map_container,map_position:[36.5297,-6.2924],source_maps:t.source_maps,result:o})}catch(e){}}(),t.form=new form_factory;const a=t.render_form();t.form_container.appendChild(a),t.set_config();return document.getElementById("search_icon").addEventListener("mousedown",(function(){let e;!0===t.map_config.showing_search?(a.classList.add("hide"),e=!1):(a.classList.remove("hide"),e=!0),t.set_config({showing_search:e})})),!0===t.map_config.showing_search?a.classList.remove("hide"):a.classList.add("hide"),!0},set_config:function(e){const t=this,n=localStorage.getItem("map_config");if(n)t.map_config=JSON.parse(n);else{const e={showing_search:!1};localStorage.setItem("map_config",JSON.stringify(e)),t.map_config=e}if(e){for(const n in e)t.map_config[n]=e[n];localStorage.setItem("map_config",JSON.stringify(t.map_config))}return t.map_config},render_form:function(){const e=this,t=new DocumentFragment,n=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:t});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:n}),e.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"name",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,q_selected_eq:"LIKE",parent:n,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"mints"})}}),e.form.item_factory({id:"collection",name:"collection",label:tstring.collection||"collection",q_column:"collection",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"coins"})}}),e.form.item_factory({id:"findspot",name:"findspot",label:tstring.findspot||"findspot",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"findspots"})}});const o=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:t});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:o}).addEventListener("click",(function(t){t.preventDefault(),e.form_submit()}));const a=e.form.build_operators_node();return t.appendChild(a),e.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),e.form.node.appendChild(t),e.form.node},form_submit:function(){const e=this;if(!e.form.node)return new Promise((function(e){e(!1)}));for(;e.rows_container.hasChildNodes();)e.rows_container.removeChild(e.rows_container.lastChild);return e.map_container.classList.add("loading"),new Promise((function(t){const n=e.form.build_filter();e.form.parse_sql_filter(n,[]);SHOW_DEBUG,data_manager.request({body:{dedalo_get:"records",table:"mints",ar_fields:["name","map","section_id"],sql_filter:`( ${e.form.form_items.mint.q_column} LIKE '%${""!==e.form.form_items.mint.q?e.form.form_items.mint.q:e.form.form_items.mint.q_selected}%' AND name !='')`,limit:0,count:!1,offset:0,order:"section_id ASC",process_result:null}}).then((function(n){const o={lon:null,lat:null};if(n.result){e.map_container.classList.remove("loading");const t=JSON.parse(n.result[0].map);o.lat=t.lat,o.lon=t.lon,e.map_factory_instance.move_map_to_point(o),e.render_rows(n.result)}t(!0)}))}))},render_rows:function(e){const t=new DocumentFragment;common.create_dom_element({element_type:"div",class_name:"container_rows",text_content:"Ceca",parent:t});this.rows_container.appendChild(t)}};