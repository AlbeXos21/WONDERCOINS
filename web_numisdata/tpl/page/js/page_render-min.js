"use strict";page.render_map_legend=function(){const e=common.create_dom_element({element_type:"div",class_name:"map_legend"});return common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.mint+'<img src="'+page.maps_config.markers.mint.iconUrl+'"/>',parent:e}),common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.hoard+'<img src="'+page.maps_config.markers.hoard.iconUrl+'"/>',parent:e}),common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.findspot+'<img src="'+page.maps_config.markers.findspot.iconUrl+'"/>',parent:e}),e},page.render_export_data_buttons=function(){function e(){const e={info:"WARNING! This is a draft version data. Please do not use it in production",source_org:"Numisdata",source_url:page_globals.__WEB_BASE_URL__,lang:page_globals.WEB_CURRENT_LANG_CODE,date:common.get_today_date()};return new Promise(function(e){if(!n)return o?void setTimeout(function(){e(o)},1e3):(console.warn("Invalid result or request_body:",n),void e(!1));n.limit=0,n.resolve_portals_custom=null,data_manager.request({body:n}).then(function(t){e(t.result)})}).then(function(t){return e.data=a&&"function"==typeof a?a(t):t,e})}function t(e){n=e.request_body,o=e.result,a=e.export_data_parser||null,r=e.filter}let n,o,a,r,m;event_manager.subscribe("data_request_done",t);const c=new DocumentFragment;if("catalog"===WEB_AREA){const e=common.create_dom_element({element_type:"div",class_name:"export_container",parent:c}),t=common.create_dom_element({element_type:"input",type:"button",value:tstring.share_search||"Share search",class_name:"btn primary button_download share_search",parent:e});t.addEventListener("click",function(){const e=psqo_factory.build_safe_psqo(r),t=common.create_dom_element({element_type:"div",class_name:"shared_wrapper",parent:document.body});t.addEventListener("click",function(e){t.remove()});const n=common.create_dom_element({element_type:"div",class_name:"shared_container",parent:t});n.addEventListener("click",function(e){e.stopPropagation()});common.create_dom_element({element_type:"div",class_name:"shared_json",text_content:JSON.stringify(e,null,2),parent:n});const o=psqo_factory.encode_psqo(e);m=window.location.protocol+"//"+window.location.host+page_globals.__WEB_ROOT_WEB__+"/"+WEB_AREA+"/?psqo="+o;const a=common.create_dom_element({element_type:"div",class_name:"shared_uri_encoded",parent:n});common.create_dom_element({element_type:"span",text_content:m,title:m.length,parent:a}),common.create_dom_element({element_type:"a",href:m,inner_html:tstring.search||"Search",target:"_blank",parent:a})})}const l=common.create_dom_element({element_type:"div",class_name:"export_container",parent:c}),s=common.create_dom_element({element_type:"input",type:"button",value:tstring.export_json||"Export JSON",class_name:"btn primary button_download json",parent:l});s.addEventListener("click",function(){const t=this;t.classList.add("unactive");const n=common.create_dom_element({element_type:"div",class_name:"spinner small",parent:l});e().then(function(e){const o="mib_export_data.json",a=new Blob([JSON.stringify(e,null,2)],{type:"application/json",name:o}),r=URL.createObjectURL(a),m=common.create_dom_element({element_type:"a",href:r,download:o});m.click(),m.remove(),n.remove(),t.classList.remove("unactive")})});const i=common.create_dom_element({element_type:"div",class_name:"export_container",parent:c}),_=common.create_dom_element({element_type:"input",type:"button",value:tstring.export_csv||"Export CSV",class_name:"btn primary button_download csv",parent:i});return _.addEventListener("click",function(){const t=this;t.classList.add("unactive");const n=common.create_dom_element({element_type:"div",class_name:"spinner small",parent:i});e().then(function(e){const o="mib_export_data.csv",a=page.convert_json_to_csv(e.data),r=new Blob([a],{type:"text/csv",name:o}),m=URL.createObjectURL(r),c=common.create_dom_element({element_type:"a",href:m,download:o});c.click(),c.remove(),n.remove(),t.classList.remove("unactive")})}),c},page.create_suggestions_button=function(){function e(e){const t=e.filter;if(null!=t){const e=psqo_factory.build_safe_psqo(t),o=psqo_factory.encode_psqo(e);n=window.location.protocol+"//"+window.location.host+page_globals.__WEB_ROOT_WEB__+"/"+WEB_AREA+"/?psqo="+o}}function t(){const e=tstring.contact_form||"Contact form",t=tstring.submit||"Submit",o=tstring.cancel||"Cancel",a=(tstring.name||"Name")+":",r=(tstring.email||"Email")+":",m=(tstring.message||"Message")+":",c=common.create_dom_element({element_type:"div",id:"popup-container"}),l=common.create_dom_element({element_type:"div",class_name:"form_container",parent:c});common.create_dom_element({element_type:"h2",class_name:"form-title",text_content:e,parent:l}),common.create_dom_element({element_type:"h3",class_name:"form-title",text_content:tstring.suggest_error||"Suggestions / errors",parent:l});let s=document.createRange().createContextualFragment('<form id="contact-form"></form>');const i=document.createRange().createContextualFragment('<label for="fname">'+a+'</label><input type="text" id="fname" name="fname" value="" required>'),_=document.createRange().createContextualFragment('<label for="fmail">'+r+'</label><input type="email" id="fmail" name="fmail" value="" required>'),d=document.createRange().createContextualFragment('<label for="fmessage">'+m+'</label><textarea id="fmessage" name="message" required></textarea>'),p=document.createRange().createContextualFragment('<input class="send-button" type="submit" value="'+t+'">'),u=document.createRange().createContextualFragment('<input class="cancel-button" type="button" value="'+o+'">'),g=document.createRange().createContextualFragment('<p id="error-msn"></p>');return s.firstElementChild.addEventListener("submit",function(e){e.preventDefault(),page.handleForm(n)}),s.firstElementChild.appendChild(i),s.firstElementChild.appendChild(_),s.firstElementChild.appendChild(d),s.firstElementChild.appendChild(g),s.firstElementChild.appendChild(p),s.firstElementChild.appendChild(u),l.appendChild(s),c}let n="";const o=new DocumentFragment,a=common.create_dom_element({element_type:"div",class_name:"form_button_container",parent:o});common.create_dom_element({element_type:"input",type:"button",value:tstring.suggest_error||"Suggestions / errors",class_name:"btn primary button_contact",parent:a}),event_manager.subscribe("data_request_done",e);const r=t();return a.addEventListener("click",function(){document.querySelector("body").appendChild(r),document.querySelector(".cancel-button").addEventListener("click",page.removeForm)}),o},page.removeForm=function(){document.querySelector(".cancel-button").removeEventListener("click",page.removeForm),document.querySelector("#popup-container").remove()},page.handleForm=function(e){document.querySelector("#error-msn").textContent="";const t=document.querySelector("#contact-form"),n=(new Date).toUTCString(),o=t.querySelector("#fname").value,a=t.querySelector("#fmail").value,r=t.querySelector("#fmessage").value;let m=window.location.href;null!=e&&e.length>0&&(m=e);const c={mail:{subject:`${o} '${a}' NUMISDATA [${n}]`,message:r},data:{name:o,email:a,message:r,lang:page_globals.WEB_CURRENT_LANG_CODE,web_url:m,date:n}};return new Promise(function(e){const n="Mensaje enviado correctamente, gracias.",o="Ha ocurrido un error. Por favor, prueba mÃ¡s tarde.";data_manager.request({url:__WEB_TEMPLATE_WEB__+"/assets/lib/sendmail/send.php",body:c}).then(e=>{console.log("--- sendmail api_response:",e),e.result?(alert(n),t.reset(),page.removeForm()):document.querySelector("#error-msn").textContent=o})})},page.render_legend=function(e){const t=e.value||"",n=e.style||"median",o=common.create_dom_element({element_type:"div",class_name:"legend_box "+n,inner_html:t.trim()});return o},page.render_type_label=function(e){let t;const n=e.ref_mint_number?e.ref_mint_number+"/":"";if(e.term_section_id&&!e.children){const o=e.term.split(", "),a=o[0],r=void 0===o[1]?"":function(){const e=[];for(let t=1;t<o.length;t++)e.push(o[t]);return'<span class="keyword">, '+e.join(", ").trim()+"</span>"}(),m=e.term_section_id&&e.term_section_id.section_id?e.term_section_id.section_id:e.term_section_id,c=common.create_dom_element({element_type:"a",class_name:"a_term",href:page_globals.__WEB_ROOT_WEB__+"/type/"+m,target:"_blank",title:n+a+o.join(", ").trim(),inner_html:n+a+r});t=c.outerHTML}else t=page_globals.OWN_CATALOG_ACRONYM+" "+n+e.term;return t},page.render_weight_value=function(e){const t=e.ref_type_averages_weight.toFixed(2).replace(/\.?0+$/,"");return t.replace(".",",")+" g"},page.render_diameter_value=function(e){const t=e.ref_type_averages_diameter.toFixed(2).replace(/\.?0+$/,"");return t.replace(".",",")+" mm"};