"use strict";page.parse_type_data=function(data){const self=this;if(Array.isArray(data)){const new_data=[];for(let i=0;i<data.length;i++)new_data.push(self.parse_type_data(data[i]));return new_data}const row=data;if("object"!=typeof row&&(console.log("parse_type_data row:",row),console.trace()),row.parsed)return row;try{row.ref_coins_image_obverse=void 0!==data.ref_coins_image_obverse?common.local_to_remote_path(data.ref_coins_image_obverse):page.default_image,row.ref_coins_image_reverse=void 0!==data.ref_coins_image_reverse?common.local_to_remote_path(data.ref_coins_image_reverse):page.default_image,row.ref_coins_union&&Array.isArray(row.ref_coins_union)?row.ref_coins_union=page.parse_coin_data(row.ref_coins_union):row.ref_coins_union=row.ref_coins_union?JSON.parse(row.ref_coins_union):null,row.coin_references&&Array.isArray(row.coin_references)?row.coin_references=page.parse_coin_data(row.coin_references):row.coin_references=row.coin_references?JSON.parse(row.coin_references):null,row.uri=self.parse_iri_data(row.uri),row.legend_obverse=row.legend_obverse?self.parse_legend_svg(row.legend_obverse):null,row.legend_reverse=row.legend_reverse?self.parse_legend_svg(row.legend_reverse):null,row.material=row.material?page.trim_char(page.remove_gaps(row.material," | "),"|"):null,row.symbol_obverse=row.symbol_obverse?self.parse_legend_svg(row.symbol_obverse):null,row.symbol_reverse=row.symbol_reverse?self.parse_legend_svg(row.symbol_reverse):null,row.symbol_obverse_data=JSON.parse(row.symbol_obverse_data),row.symbol_reverse_data=JSON.parse(row.symbol_reverse_data),row.term_data=row.term_data?JSON.parse(row.term_data):null,row.term_section_tipo=row.term_section_tipo?JSON.parse(row.term_section_tipo):null,row.term_section_label=row.term_section_label?JSON.parse(row.term_section_label):null,row.parsed=!0}catch(error){console.error("ERROR CATCH ",error),console.warn("row:",row)}return row},page.parse_mint_data=function(data){const self=this;if(Array.isArray(data)){const new_data=[];for(let i=0;i<data.length;i++)new_data.push(page.parse_mint_data(data[i]));return new_data}const row=data;return"object"!=typeof row&&(console.log("parse_mint_data row:",row),console.trace()),!row||row.parsed?row:(row.georef_geojson=row.georef_geojson?JSON.parse(row.georef_geojson):null,row.map=row.map?JSON.parse(row.map):null,row.place_data=row.place_data?JSON.parse(row.place_data):null,row.uri=this.parse_iri_data(row.uri),row.relations_coins=row.relations_coins?JSON.parse(row.relations_coins):null,row.relations_types=row.relations_types?JSON.parse(row.relations_types):null,row)},page.parse_hoard_data=function(data){Array.isArray(data)||(data=[data]);const parsed_data=[];try{if(!data)return data;for(let i=0;i<data.length;i++){const row=data[i];!0!==row.parsed?(row.map=row.map?JSON.parse(row.map):null,row.coins=row.coins?JSON.parse(row.coins):null,row.types=row.types?JSON.parse(row.types):null,row.georef_geojson=row.georef_geojson?JSON.parse(row.georef_geojson):null,row.parsed=!0,parsed_data.push(row)):parsed_data.push(row)}}catch(error){console.error("ERROR CATCH ",error),console.warn("data:",data)}return parsed_data},page.parse_coin_data=function(data){const self=this;if(Array.isArray(data)){const new_data=[];for(let i=0;i<data.length;i++)new_data.push(page.parse_coin_data(data[i]));return new_data}const row=data;if("object"!=typeof row&&(console.log("parse_coin_data row:",row),console.trace()),!row||row.parsed)return row;try{row.image_obverse=row.image_obverse?common.local_to_remote_path(data.image_obverse):page.default_image,row.image_obverse_thumb=row.image_obverse?row.image_obverse.replace("/1.5MB/","/thumb/"):page.default_image,row.image_reverse=row.image_reverse?common.local_to_remote_path(data.image_reverse):page.default_image,row.image_reverse_thumb=row.image_reverse?row.image_reverse.replace("/1.5MB/","/thumb/"):page.default_image,row.type_data&&Array.isArray(row.type_data)?row.type_data=self.parse_type_data(row.type_data):(row.type_data=row.type_data?JSON.parse(row.type_data):null,row.type_section_id=row.type_data&&void 0!==row.type_data[0]?row.type_data[0]:null);const separator=" | ";row.type=row.type?page.split_data(row.type,separator):null;const mint_data=row.mint_data?page.split_data(row.mint_data,separator):[],ar_mints_data=[];for(let i=0;i<mint_data.length;i++)ar_mints_data.push(JSON.parse(mint_data[i]));row.mint_data=ar_mints_data||null;const mint_number=row.mint_number?page.split_data(row.mint_number,separator):[],ar_mints_number=[];for(let i=0;i<mint_number.length;i++)ar_mints_number.push(JSON.parse(mint_number[i]));row.mint_number=ar_mints_number||null;const mints=row.mint?page.split_data(row.mint,separator):[],ar_mints=[];for(let i=0;i<mints.length;i++)if(mints[i]){const current_mints=0===mints[i].indexOf('["')?JSON.parse(mints[i]):mints[i];current_mints&&ar_mints.push(current_mints)}if(row.mint=ar_mints||null,row.catalogue_type_mint=row.catalogue_type_mint?0===row.catalogue_type_mint.indexOf('["')?JSON.parse(row.catalogue_type_mint):row.catalogue_type_mint:null,row.legend_obverse=row.legend_obverse?self.parse_legend_svg(row.legend_obverse):null,row.legend_reverse=row.legend_reverse?self.parse_legend_svg(row.legend_reverse):null,row.countermark_obverse=row.countermark_obverse?self.parse_legend_svg(row.countermark_obverse):null,row.countermark_reverse=row.countermark_reverse?self.parse_legend_svg(row.countermark_reverse):null,row.ref_auction=row.ref_auction?JSON.parse(row.ref_auction):null,row.ref_auction_date=row.ref_auction_date?JSON.parse(row.ref_auction_date):null,row.ref_auction_number=row.ref_auction_number?JSON.parse(row.ref_auction_number):null,row.ref_auction_group=null,row.ref_auction&&row.ref_auction.length>0){row.ref_auction_group=[];for(let g=0;g<row.ref_auction.length;g++)row.ref_auction_group.push({name:row.ref_auction&&void 0!==row.ref_auction[g]?row.ref_auction[g]:"",date:row.ref_auction_date&&void 0!==row.ref_auction_date[g]?self.parse_date(row.ref_auction_date[g]):"",number:row.ref_auction_number&&void 0!==row.ref_auction_number[g]?row.ref_auction_number[g]:""})}if(row.ref_related_coin_auction=row.ref_related_coin_auction?JSON.parse(row.ref_related_coin_auction):null,row.ref_related_coin_auction_date=row.ref_related_coin_auction_date?JSON.parse(row.ref_related_coin_auction_date):null,row.ref_related_coin_auction_number=row.ref_related_coin_auction_number?JSON.parse(row.ref_related_coin_auction_number):null,row.ref_related_coin_auction_group=null,row.ref_related_coin_auction&&row.ref_related_coin_auction.length>0){row.ref_related_coin_auction_group=[];for(let g=0;g<row.ref_related_coin_auction.length;g++)row.ref_related_coin_auction_group.push({name:row.ref_related_coin_auction&&void 0!==row.ref_related_coin_auction[g]?row.ref_related_coin_auction[g]:"",date:row.ref_related_coin_auction_date&&void 0!==row.ref_related_coin_auction_date[g]?self.parse_date(row.ref_related_coin_auction_date[g]):"",number:row.ref_related_coin_auction_number&&void 0!==row.ref_related_coin_auction_number[g]?row.ref_related_coin_auction_number[g]:""})}row.find_date=self.parse_date(row.find_date),row.coin_uri=page_globals.__WEB_ROOT_WEB__+"/coin/"+row.section_id,row.uri=self.parse_iri_data(row.uri),row.bibliography_data&&Array.isArray(row.bibliography_data)&&(row.bibliography=page.parse_publication(row.bibliography_data)),row.parsed=!0}catch(error){console.error("ERROR CATCH ",error),console.warn("row:",row)}return row},page.parse_catalog_data=function(data){const self=this;if(!data)return[];Array.isArray(data)||(data=[data]);const new_data=[];try{const data_length=data.length;for(let i=0;i<data_length;i++){const row=data[i];function IsJson(argument){try{JSON.parse(argument)}catch(e){return!1}return!0}row.parsed||(row.coins_data_union=row.coins_data_union?JSON.parse(row.coins_data_union):null,row.coin_references=row.coin_references?JSON.parse(row.coin_references):null,row.ref_coins_image_obverse=row.ref_coins_image_obverse?common.local_to_remote_path(row.ref_coins_image_obverse):page.default_image,row.ref_coins_image_reverse=row.ref_coins_image_reverse?common.local_to_remote_path(row.ref_coins_image_reverse):page.default_image,row.ref_coins_image_obverse_thumb=row.ref_coins_image_obverse?row.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):page.default_image,row.ref_coins_image_reverse_thumb=row.ref_coins_image_reverse?row.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):page.default_image,row.ref_type_legend_obverse=row.ref_type_legend_obverse?self.parse_legend_svg(row.ref_type_legend_obverse):null,row.ref_type_legend_reverse=row.ref_type_legend_reverse?self.parse_legend_svg(row.ref_type_legend_reverse):null,row.ref_type_symbol_obverse=row.ref_type_symbol_obverse?self.parse_legend_svg(row.ref_type_symbol_obverse):null,row.ref_type_symbol_reverse=row.ref_type_symbol_reverse?self.parse_legend_svg(row.ref_type_symbol_reverse):null,IsJson(row.term_data)&&(row.term_data=JSON.parse(row.term_data)),row.term_section_id=row.term_data?row.term_data[0]:null,row.children=row.children?JSON.parse(row.children):null,row.parent=row.parent?Array.isArray(row.parent)?(parent_array=row.parent,page.parse_catalog_data(parent_array)):JSON.parse(row.parent):null,row.ref_type_averages_diameter=row.ref_type_averages_diameter?parseFloat(row.ref_type_averages_diameter.replace(",",".")):null,row.ref_type_total_diameter_items=row.ref_type_total_diameter_items?parseFloat(row.ref_type_total_diameter_items.replace(",",".")):null,row.ref_type_averages_weight=row.ref_type_averages_weight?parseFloat(row.ref_type_averages_weight.replace(",",".")):null,row.ref_type_total_weight_items=row.ref_type_total_weight_items?parseFloat(row.ref_type_total_weight_items.replace(",",".")):null,row.ref_type_material=page.trim_char(row.ref_type_material,"|"),row.ref_type_design_obverse_iconography=row.ref_type_design_obverse_iconography?row.ref_type_design_obverse_iconography.replace(" - "," | "):null,row.ref_type_design_reverse_iconography=row.ref_type_design_reverse_iconography?row.ref_type_design_reverse_iconography.replace(" - "," | "):null,row.ref_type_denomination_data=row.ref_type_denomination_data?JSON.parse(row.ref_type_denomination_data):null,row.term_section_label=row.term_section_label?JSON.parse(row.term_section_label):null,row.term_section_tipo=row.term_section_tipo?JSON.parse(row.term_section_tipo):null,row.p_mint=row.p_mint?JSON.parse(row.p_mint):null,row.p_period=row.p_period?JSON.parse(row.p_period):null,row.p_territory=row.p_territory?JSON.parse(row.p_territory):null,row.parents=row.parents?IsJson(row.parents)?JSON.parse(row.parents):row.parents:null,row.parents_text=row.parents_text?JSON.parse(row.parents_text):null,row.p_culture=row.p_culture?JSON.parse(row.p_culture):null,row.full_coins_reference_diameter_max=row.full_coins_reference_diameter_max?JSON.parse(row.full_coins_reference_diameter_max):null,row.full_coins_reference_diameter_min=row.full_coins_reference_diameter_min?JSON.parse(row.full_coins_reference_diameter_min):null,row.full_coins_reference_weight=row.full_coins_reference_weight?JSON.parse(row.full_coins_reference_weight):null,row.full_coins_reference_calculable=row.full_coins_reference_calculable?JSON.parse(row.full_coins_reference_calculable):null,row.full_coins_reference_axis=row.full_coins_reference_axis?JSON.parse(row.full_coins_reference_axis):null,new_data.push(row))}for(let i=0;i<data_length;i++){const row=new_data[i];if(!row.parsed&&"types"===row.term_table&&row.children){const ar_mesures_diameter=[],ar_mesures_weight=[];for(let i=0;i<row.children.length;i++){const current_child=row.children[i],child_row=data.find(el=>el.section_id==current_child);if(child_row&&child_row.ref_type_averages_weight){const weight_items=child_row.ref_type_total_weight_items,ar_current_mesures_weight=new Array(weight_items).fill(child_row.ref_type_averages_weight);ar_mesures_weight.push(...ar_current_mesures_weight)}if(child_row&&child_row.ref_type_averages_diameter){const diameter_items=child_row.ref_type_total_diameter_items,ar_current_mesures_diameter=new Array(diameter_items).fill(child_row.ref_type_averages_diameter);ar_mesures_diameter.push(...ar_current_mesures_diameter)}}const media_weight=ar_mesures_weight.reduce((a,b)=>a+b,0)/ar_mesures_weight.length,media_diameter=ar_mesures_diameter.reduce((a,b)=>a+b,0)/ar_mesures_diameter.length;row.ref_type_averages_weight=media_weight,row.ref_type_averages_diameter=media_diameter,row.ref_type_total_weight_items=ar_mesures_weight.length,row.ref_type_total_diameter_items=ar_mesures_diameter.length}row.parsed=!0}}catch(error){console.error("ERROR CATCH ",error),console.warn("new_data:",new_data)}var parent_array;return new_data},page.parse_publication=function(data){const parsed_data=[];try{if(!data)return data;const separator=" # ",data_length=data.length;for(let i=0;i<data_length;i++){const reference=data[i];if(reference.parsed)continue;reference._publications=[];const publications_data=reference.publications_data?JSON.parse(reference.publications_data):[],publications_data_length=publications_data.length;if(publications_data_length>0){const ref_publications_authors=page.split_data(reference.ref_publications_authors,separator),ref_publications_date=page.split_data(reference.ref_publications_date,separator),ref_publications_editor=page.split_data(reference.ref_publications_editor,separator),ref_publications_magazine=page.split_data(reference.ref_publications_magazine,separator),ref_publications_place=page.split_data(reference.ref_publications_place,separator),ref_publications_title=page.split_data(reference.ref_publications_title,separator),ref_publications_url=page.split_data(reference.ref_publications_url,separator);for(let j=0;j<publications_data_length;j++){const section_id=publications_data[j],parsed_item={reference:reference.section_id,section_id:section_id,authors:ref_publications_authors[j]||null,date:ref_publications_date[j]||null,editor:ref_publications_editor[j]||null,magazine:ref_publications_magazine[j]||null,place:ref_publications_place[j]||null,title:ref_publications_title[j]||null,url:ref_publications_url[j]||null};reference._publications.push(parsed_item),parsed_data.push(parsed_item)}}reference.parsed=!0}}catch(error){console.error("ERROR CATCH ",error),console.warn("data:",data)}return parsed_data},page.parse_map_global_data=function(ar_rows){const self=this;try{const ar_rows_length=ar_rows.length;for(let i=0;i<ar_rows_length;i++){const row=ar_rows[i];if(!row.parsed){if(row.georef_geojson=row.georef_geojson?JSON.parse(row.georef_geojson):null,row.coins_list=row.coins_list?JSON.parse(row.coins_list):[],row.types_list=row.types_list?JSON.parse(row.types_list):[],row.georef_geojson&&row.georef_geojson.length>0){const name=function(table){let name;switch(table){case"mints":name="mint";break;case"hoards":name="hoard";break;case"findspots":name="findspot"}return name}(row.table),coins_list_total=row.coins_list?row.coins_list.length:0,types_list_total=row.types_list?row.types_list.length:0,title='<span class="note">'+(tstring[name]||name)+"</span> "+row.name,description=(tstring.coins||"Coins")+": "+coins_list_total,item_data={section_id:row.section_id,title:title,coins_total:coins_list_total,types_total:types_list_total,description:description,ref_section_id:row.ref_section_id,ref_section_tipo:row.ref_section_tipo,table:row.table,name:row.name,term_id:row.section_id},marker_icon=page.maps_config.markers[name],item={lat:null,lon:null,geojson:row.georef_geojson,marker_icon:marker_icon,data:item_data};row.item=item}else row.item=null;row.parsed=!0}}}catch(error){console.error("ERROR CATCH ",error),console.warn("ar_rows:",ar_rows)}return ar_rows},page.parse_iri_data=function(data){const items=[];if(!data||data.length<1)return items;const values=data.split(" | ");for(let i=0;i<values.length;i++){const val=values[i],parts=val.split(", ");if(parts.length>1&&void 0===parts[1])continue;const url=1===parts.length?parts[0]:parts[1];let source=1===parts.length?"":parts[0];if(source.length<1)try{const _url=new URL(url);source=_url.hostname}catch(error){console.log("url:",url),console.warn(error)}items.push({label:source,value:url})}return items},page.parse_ts_web=function(rows){Array.isArray(rows)||(rows=[rows]);for(let i=0;i<rows.length;i++){const row=rows[i];!0!==row.parsed&&(row.cuerpo=row.cuerpo?row.cuerpo.replaceAll("../../../media",page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media"):null,row.entradilla=row.entradilla?row.entradilla.replaceAll("../../../media",page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media"):null,row.parsed=!0)}return rows},page.parse_tree_data=function(ar_rows,hilite_terms){const data=[],ar_parse=["parent","children","space","mib_bibliography","term_data"];function decode_field(field){return field?JSON.parse(field):null}function parse_item(item){for(let i=ar_parse.length-1;i>=0;i--){const name=ar_parse[i];item[name]=decode_field(item[name])}return item}const ar_rows_length=ar_rows.length;for(let i=0;i<ar_rows_length;i++){const item=parse_item(ar_rows[i]);if(item.children){const current_ar_children=[],children_length=item.children.length;for(let k=0;k<children_length;k++){const current_child=item.children[k],unfified_format="object"==typeof current_child?current_child.section_tipo+"_"+current_child.section_id:current_child,found=ar_rows.find(el=>el.term_id===unfified_format);found&&current_ar_children.push(unfified_format)}item.children=current_ar_children}data.push(item)}const term_id_to_remove=[],data_length=ar_rows_length;for(let i=data_length-1;i>=0;i--){const row=data[i],parent_term_id=!(!row.parent||!row.parent[0])&&row.parent[0];parent_term_id||(console.warn("Ignored undefined parent_term_id:",row.term_id,row),term_id_to_remove.push(row.term_id))}term_id_to_remove.length>0&&console.warn("term_id_to_remove:",term_id_to_remove);const data_clean=data.filter(el=>-1===term_id_to_remove.indexOf(el.term_id));for(let i=0;i<data_clean.length;i++){const row=data_clean[i];if(hilite_terms&&(-1!==hilite_terms.indexOf(row.term_id)||row.nd_term_id&&-1!==hilite_terms.indexOf(row.nd_term_id))&&(row.hilite=!0),hilite_terms)if(-1!==hilite_terms.indexOf(row.term_id))row.hilite=!0;else if(row.nd_term_id)for(let i=0;i<row.nd_term_id.length;i++)if(-1!==hilite_terms.indexOf(row.nd_term_id[i])){row.hilite=!0;break}!0===row.hilite&&set_status_as_opened(data_clean,row)}function set_status_as_opened(data_clean,row){const parent_term_id=row.parent[0],parent_row=data_clean.find(item=>item.term_id==parent_term_id);parent_row&&(parent_row.status="opened",set_status_as_opened(data_clean,parent_row))}return data_clean},page.parse_activity_data=function(data){Array.isArray(data)||(data=[data]);const parsed_data=[];try{if(!data)return data;for(let i=0;i<data.length;i++){const row=data[i];!0!==row.parsed?(row.activity=row.activity?JSON.parse(row.activity):null,row.parsed=!0,parsed_data.push(row)):parsed_data.push(row)}}catch(error){console.error("ERROR CATCH ",error),console.warn("data:",data)}return parsed_data};