"use strict";function map_factory(){this.map_container=[],this.map_position=null,this.source_maps=[],this.map=null,this.map_node=null,this.result=null,this.findspot=!1,this.init=function(options){const self=this;self.map_node=options.map_node||null,self.map_container=options.map_container||null,self.map_position=options.map_position||[36.5297,-6.2924],self.popup_options=options.popup_options||{},self.source_maps=options.source_maps||[],self.result=options.result||null,self.findspot=options.findspot||!1;const containerElement="string"==typeof self.map_container?document.getElementById(self.map_container):self.map_container;if(containerElement)return self.map=L.map(containerElement).setView(self.map_position,8),self.add_layer_control(self.map,self.source_maps),self.findspot?L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(self.map):(L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(self.map),self.create_legend(self.map)),setTimeout(()=>{self.map.invalidateSize()},200),self.add_markers(self.map,self.result,self.map_node),self.map;console.error("Contenedor del mapa no válido.")},this.add_layer_control=function(map,source_maps){if(source_maps.length>0){const baseLayers={};source_maps.forEach(layer=>{baseLayers[layer.name]=L.tileLayer(layer.url,layer.options)}),L.control.layers(baseLayers).addTo(map)}},this.add_markers=function(map,data,map_node){const markersCluster=L.markerClusterGroup({maxClusterRadius:80,iconCreateFunction:function(cluster){return L.divIcon({html:`<div class="custom-cluster">${cluster.getChildCount()}</div>`,className:"",iconSize:[40,40]})}}),iconoCeca=L.icon({iconUrl:"tpl/assets/images/map/IMG_8276.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),iconoHallazgo=L.icon({iconUrl:"tpl/assets/images/map/IMG_5962.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});function miFuncionPersonalizada(tipo){console.log("Se hizo clic en:",tipo)}for(let index=0;index<data.hallazgos.datos.length;index++){let data_ceca=null;try{data_ceca=JSON.parse(data.hallazgos.datos[index].map)}catch(error){data_ceca=data.hallazgos.datos[index].map}if(null!=data_ceca){const markerHallazgo=L.marker([data_ceca.lat,data_ceca.lon],{icon:iconoHallazgo}).bindPopup(`<b>Hallazgo</b><br>${data.hallazgos.datos[index].name}`).on("click",(function(){miFuncionPersonalizada(data.hallazgos.datos[index].name),this.openPopup()}));markersCluster.addLayer(markerHallazgo)}}for(let index=0;index<data.cecas.datos.length;index++){const data_ceca=JSON.parse(data.cecas.datos[index].map);if(null!=data_ceca&&void 0!==data_ceca.lat&&void 0!==data_ceca.lon){const markerCeca=L.marker([data_ceca.lat,data_ceca.lon],{icon:iconoCeca}).bindPopup(`<b>Ceca</b><br>${data.cecas.datos[index].name}`).on("click",(async function(){const monedas=await map_node.cargarMonedasCecas(data.cecas.datos[index].name);for(;map_node.rows_container.hasChildNodes();)map_node.rows_container.removeChild(self.rows_container.lastChild);map_node.render_rows(data.cecas.datos[index],monedas.result),this.openPopup()}));markersCluster.addLayer(markerCeca)}}map.addLayer(markersCluster)},this.create_legend=function(map){L.control.Legend({position:"bottomleft",collapsed:!1,title:"Leyenda",columns:2,legends:[{label:"Ceca",type:"image",url:"tpl/assets/images/map/IMG_8276.png"},{label:"Hallazgo",type:"image",url:"tpl/assets/images/map/IMG_5962.png"},{label:"Complejo",type:"image",url:"tpl/assets/images/map/orange.png"}]}).addTo(map)},this.move_map_to_point=function(location){this.map.setView([location.lat,location.lon],14)}}